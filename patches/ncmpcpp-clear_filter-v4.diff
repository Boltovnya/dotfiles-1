From ac49f703045aad97b72350982331d79dc626a7a8 Mon Sep 17 00:00:00 2001
From: Marc Jessome <marc.jessome@gmail.com>
Date: Tue, 10 Apr 2012 20:39:10 -0400
Subject: [PATCH] Add command to clear filter.

---
 src/help.cpp     |    1 +
 src/ncmpcpp.cpp  |   20 ++++++++++++++++++++
 src/settings.cpp |    4 ++++
 src/settings.h   |    1 +
 4 files changed, 26 insertions(+), 0 deletions(-)

diff --git a/src/help.cpp b/src/help.cpp
index 70d907f..bad9129 100644
--- a/src/help.cpp
+++ b/src/help.cpp
@@ -210,6 +210,7 @@ void Help::GetKeybindings()
 	*w << DisplayKeys(Key.UpdateDB)			<< "Start a music database update\n";
 	*w << "\n";
 	*w << DisplayKeys(Key.ApplyFilter)		<< "Apply filter\n";
+	*w << DisplayKeys(Key.DisableFilter)    << "Disable filter\n";
 	*w << DisplayKeys(Key.FindForward)		<< "Forward find\n";
 	*w << DisplayKeys(Key.FindBackward)		<< "Backward find\n";
 	*w << DisplayKeys(Key.PrevFoundPosition)	<< "Go to previous found position\n";
diff --git a/src/ncmpcpp.cpp b/src/ncmpcpp.cpp
index eba09c4..6738e7d 100644
--- a/src/ncmpcpp.cpp
+++ b/src/ncmpcpp.cpp
@@ -2024,6 +2024,26 @@ int main(int argc, char *argv[])
 				RedrawHeader = 1;
 			}
 		}
+		else if (Keypressed(input, Key.DisableFilter))
+		{
+			List *mList = myScreen->GetList();
+			
+			if (!mList)
+				continue;
+			
+			std::string tmp = "";
+			mList->ApplyFilter(tmp);
+			//StatusbarApplyFilterImmediately(tmp);
+			
+			ShowMessage("Filtering disabled");
+			
+			if (myScreen == myPlaylist)
+			{
+				myPlaylist->EnableHighlighting();
+				Playlist::ReloadTotalLength = 1;
+				RedrawHeader = 1;
+			}
+		}
 		else if (Keypressed(input, Key.FindForward) || Keypressed(input, Key.FindBackward))
 		{
 			List *mList = myScreen->GetList();
diff --git a/src/settings.cpp b/src/settings.cpp
index 2c3e467..ebb48da 100644
--- a/src/settings.cpp
+++ b/src/settings.cpp
@@ -229,6 +229,7 @@ void NcmpcppKeys::SetDefaults()
 	UpdateDB[0] = 'u';
 	SortPlaylist[0] = 22;
 	ApplyFilter[0] = 6;
+	DisableFilter[0] = 7;
 	FindForward[0] = '/';
 	FindBackward[0] = '?';
 	NextFoundPosition[0] = '.';
@@ -319,6 +320,7 @@ void NcmpcppKeys::SetDefaults()
 	UpdateDB[1] = NullKey;
 	SortPlaylist[1] = NullKey;
 	ApplyFilter[1] = NullKey;
+	DisableFilter[1] = NullKey;
 	FindForward[1] = NullKey;
 	FindBackward[1] = NullKey;
 	NextFoundPosition[1] = NullKey;
@@ -593,6 +595,8 @@ void NcmpcppKeys::Read()
 				GetKeys(key, SortPlaylist);
 			else if (name == "key_apply_filter")
 				GetKeys(key, ApplyFilter);
+			else if (name == "key_clear_filter")
+				GetKeys(key, DisableFilter);
 			else if (name == "key_find_forward")
 				GetKeys(key, FindForward);
 			else if (name == "key_find_backward")
diff --git a/src/settings.h b/src/settings.h
index 0df7dfd..4d311c3 100644
--- a/src/settings.h
+++ b/src/settings.h
@@ -110,6 +110,7 @@ struct NcmpcppKeys
 	int UpdateDB[2];
 	int SortPlaylist[2];
 	int ApplyFilter[2];
+	int DisableFilter[2];
 	int FindForward[2];
 	int FindBackward[2];
 	int NextFoundPosition[2];
-- 
1.7.7

